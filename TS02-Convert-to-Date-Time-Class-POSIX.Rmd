---
layout: post
title: "Lesson 02: Convert Date-Time from Characters to a Date-Time Class (POSIX) in R"
date: 2015-10-23
authors: [Megan A. Jones, Marisa Guarinello, Courtney Soderberg]
contributors: [Leah A. Wasser]
dateCreated: 2015-10-22
lastModified: `r format(Sys.time(), "%Y-%m-%d")`
packagesLibraries: [lubridate]
tags: module-1
description: "This lesson explain how to prepare tabular data for further
analysis in `R` through understanding date-time classes and learning how to
convert character class data to a POSIX date-time class."
code1:
image:
  feature: NEONCarpentryHeader_2.png
  credit: A collaboration between the National Ecological Observatory Network (NEON) and Data Carpentry
  creditlink: http://www.neoninc.org
permalink: /R/Convert-to-Date-Time-Class-POSIX-R
comments: false
---

{% include _toc.html %}

##About
This lesson explain how to prepare tabular data for further analysis in `R` 
through understanding date-time classes and learning how to convert character
class data to a POSIX date-time class

**R Skill Level:** Intermediate - you've got the basics of `R` down and 
understand the general structure of tabular data.

<div id="objectives" markdown="1">

### Goals / Objectives
After completing this activity, you will:

 * Examine data structures and classes
 * Understand what POSIXct and POSIXlt data classes are and why we are using POSIXct. 
 * Be aware of other date-time classes. 
 * Be able to convert data between different date-time classes. 
 * Be able to designate which format a date-time class will be displayed in. 


###Things You'll Need To Complete This Lesson
Please be sure you have the most current version of `R` and, preferably,
RStudio to write your code.

####R Libraries to Install
<li><strong>lubridate:</strong> <code> install.packages("lubridate")</code></li>

####Data to Download
{% include /maps/_tabular-time-series-data.html %}

####Setting the Working Directory
The code in this lesson assumes that you have set your working directory to the
location of the unzipped file of data downloaded above.  If you would like a
refresher on setting the working directory, please view the [Setting A Working Directory In R](URL "R Working Directory Lesson") lesson prior to beginning
this lesson.

</div>

In [Lesson 00: A Brief Intro to Time-Series Data ](URL "Lesson 00 for Date Only")
we imported a
`.csv` time series dataset and learned how to cleanly plot these data by 
converting the date column to an `R` `Date` data class.  In this lesson we will 
explore how to work with data column that contains both a date AND a time stamp.

We will be using functions from both base `R` and the `lubridate` 
package to learn how to work with date-time data classes.

We will use the `hf001-10-15min-m.csv` file that contains micrometeoreology
data including our variables of interest: temperature, precipitation and 
photosynthetically active radiation (PAR), for Harvard Forest, aggregated at
15-minute intervals. If you have not previously loaded this file, we will do so 
now. 

```{r load-libraries}

# Load packages required for entire script
library(lubridate)  #work with dates

#set working directory to ensure R can find the file we wish to import
#setwd("working-dir-path-here")

#Load csv file of 15 min meteorological data from Harvard Forest
#Factors=FALSE so strings, series of letters/ words/ numerals, remain characters
harMet_15Min <- read.csv(file="AtmosData/HARV/hf001-10-15min-m.csv",
                     stringsAsFactors = FALSE)
```

##Date and Time Data

Let's revisit the data structure,looking specifically at the `date-time` data.
It is in which data class? 

```{r view-date-structure }
#view column data class
class(harMet_15Min$datetime)

#view sample data
head(harMet_15Min$datetime)

```

Our `datetime` column is in a character data type. We need to convert it to 
date-time data class. What happens when we use the `as.Date` method we learned
in [Lesson 00: A Brief Intro to Time-Series Data ](URL "Lesson 00 for as.Date") 
on our `datetime` column?

```{r as-date-only, results="hide" }

#convert column to date class
har_dateOnly <- as.Date(harMet_15Min$datetime)

#view data
head(har_dateOnly)

```

We've lost the time stamp associated with the `datetime` data. The `as.Date` 
method worked great for data with just dates, but it doesn't store any time
information. Let's take a minute to explore the various date/time classes in
`R`.

## Exploring Date and Time Classes

###R - Date Class - as.Date
As we just saw, when we use the`as.Date` method to convert date data that is
a string/character class to an `R` `date` class, it will ignore all values after
the date string.

Let's explore date classes in more detail separately from our data set.

```{r explore-as_date }
#Convert character data to date (no time) 
myDate <- as.Date("2015-10-19 10:15")   
str(myDate)
myDate

#what happens if the date has text at the end?
myDate2 <- as.Date("2015-10-19Hello")   
str(myDate2)
myDate2

```

As we can see above the `as.Date()` function will convert the characters that it
recognizes to be part of a date into a Date class and ignore all other
characters in the string. 

###R - Date-Time - The POSIX classes
Given that we do have data and time that are both important for our time series 
we need to use a data class that includes time and date.  Base `R` offers two 
closely related classes for date and time: `POSIXct` and `POSIXlt`. Let's 
explore both of these before choosing which one to use with our data.

```{r explore-POSIXct }
#Convert character data to date and time.
timeDate <- as.POSIXct("2015-10-19 10:15")   
str(timeDate)
timeDate

```

The `as.POSIXct` method converts a date-time string into a `POSIXct` class. We
see the date and time with a time zone designation - the time zone your computer
is set to, likely your local time zone. 

POSIXct stores date and time as the number of seconds since 1 January 1970
(negative numbers are used for dates before 1970). As each date and time is 
just a single number this class is easy to use in data frames and to convert
from one format to another. 

```{r explore-POSIXct2 }
#to see the data in this 'raw' format, i.e., not formatted according to the 
#class type to show us a date we recognize, use the `unclass()` function.
unclass(timeDate)
```

Here we see the number of seconds from 1 January 1970 to 9 October 2015 and
see that it has a time zone attribute stored with it. 

While easy for data storage and manipulations, humans aren't so good at working
with seconds from 1970 to figure out a date. Plus, we often want to pull out
some portion of the data (e.g., months). The POSIXlt class stores date and time
information in a format that we are used to seeing (e.g., 
second, min, hour, day of month, month, year, numeric day of year, etc). 

```{r explore-POSIXlt }
#Convert character data to POSIXlt date and time
timeDatelt<- as.POSIXlt("2015-10-19 10:15")  
str(timeDatelt)
timeDatelt

unclass(timeDatelt)
```

When we converted the string to `POSIXlt`, it still appears to be the same as 
`POSIXct`. However, `unclass()` shows us that the data are stored differently. 
The `POSIXlt` class stores the hour, minute, second, day, month, and year as 
separate components.

Yet, just like `POSIXct` being based on seconds since 1 Jan. 1970, `POSIXlt` has
a few quirks.  First, the months use zero based indexing which starts counting
with zero instead of 1 so October is stored as the 9th month (`$mon = 9`) and 
the years are based on years since 1900 so 2015 is stored as 115 (`$year = 115`)
Information like this can always be found in the `R` documentation by using `?`
(specifically `?POSIXlt`).  

Having dates classified as seperate components makes `POSIXlt` computationally
more difficult to use in data frames, which is why we won't use POSIXlt for this
lesson.  

Instead we can specified which format (e.g., year-month-day hour:minute or 
day/month/year hour:minute) we wanted to see the date and time when using
POSIXct. 

###R- Data-Time - Other Classes
There are many other options in `R` for date-time data classes, including 
packages `readr` and `zoo`. The `chron` package allows the use of time
without a date attached.  

##Convert Data Frame Data to Date-time Class

### Date-Time Formats
We can tell R how our data are formatted (or, in other contexts, how we want to
view date and time) using a `format=` string.  

```{r view-date }

#view one date time entry
harMet_15Min$datetime[1]

```

Our data is in Year-Month-Day "T" Hour:Minute:Second, so we can use the 
following designations for the components of the date-time data:

* %Y - year 
* %m - month
* %d - day
* %H:%M - hours:minutes

Bonus: A list of options for the date-time formatting are given in the help for 
the `strptime` function (`help(strptime)`).   {: .notice2}

The "T" inserted into the middle of datetime isn't a standard character for date 
and time, however we can tell `R` where the character is and it will interpret
the correct date and time.  

```{r format-date}
#convert single instance of date/time in format year-month-day hour:min:sec
as.POSIXct(harMet_15Min$datetime[1],format="%Y-%m-%dT%H:%M")

##The format of date-time MUST match the specified format or the data will not
# convert; see what happens when you try it a different way
as.POSIXct(harMet_15Min$datetime[1],format="%m-%d-%YT%H:%M")

```

Using the syntax we've learned, we can convert the entire `datetime` column into 
`POSIXct` data class.

##Select a Time Zone
Whenever using time data it is essential to know what time zone the
data were collected in and in what time zone they are stored within `R`.  Data 
may be collected and stored in a local time zone but storage in Coordinated 
Universal Time (UTC) or GMT is a common default. 

```{r time-zone-HarMet }
#checking time zone of data as R sees it
tz(harMet_15Min)
```

`R` currently interprets that the time data are record in UTC. We need to make 
sure it corresponds with what we know is true for the data.  
In [Lesson 01 ](URL "Lesson 01 for Metadata") about the 
associated metadata, we learned that the data were collected in Eastern Standard 
Time.  

We need to designate the correct time zone when converting the data to POSIX.
There are individual designations for different time zones and time zone 
variants (e.g., is daylight savings time observed). All of the codes can be
found in this <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank"> time zone table</a>. 

The code for the Eastern time zone that is the closest match to the Harvard
Forest is `America/New_York`. To try this out let's convert the first entry to 
POSIXct specifying the format and the correct time zone. 

```{r assign-time-zone }
#assign time zone to just the first entry
as.POSIXct(harMet_15Min$datetime[1],
            format = "%Y-%m-%dT%H:%M",
            tz = "America/New_York")
```

We can see that the time zone is now correctly set as EST.  

## Convert to Date-time Data Class
Now, using the syntax that we learned above, we can convert the entire `datetime`
column in the object to an `POSIXct` class.

```{r POSIX-convert-best-practice-code}
#convert to POSIXct date-time class
harMet_15Min$datetime <- as.POSIXct(harMet_15Min$datetime,
                                format = "%Y-%m-%dT%H:%M",
                                tz = "America/New_York")

#view structure and time zone of the newly defined datetime column
str(harMet_15Min$datetime)
tz(harMet_15Min$datetime)
```

Now that our `datetime` data is properly identified as a `POSIXct` date-time
data class we can continue on and look at the patterns of precipitation,
temperature, and PAR through time. 
