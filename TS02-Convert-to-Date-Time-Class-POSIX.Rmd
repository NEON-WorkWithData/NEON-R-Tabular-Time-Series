---
layout: post
title: "Lesson 02: Convert Date-Time Fields from Characters to a Date-Time Class (POSIX) in R"
date: 2015-10-23
authors: [Megan A. Jones, Marisa Guarinello, Courtney Soderberg]
contributors: [Leah A. Wasser]
dateCreated: 2015-10-22
lastModified: `r format(Sys.time(), "%Y-%m-%d")`
packagesLibraries: [lubridate]
tags: module-1
description: "This lesson will teach individuals how to prepare tabular data for
further analysis in R, addressing missing values and date-time formats. Students
will also learn how to convert characters to a date-time class and to convert
date-time to Julian day."
code1:
image:
  feature: NEONCarpentryHeader_2.png
  credit: A collaboration between the National Ecological Observatory Network (NEON) and Data Carpentry
  creditlink: http://www.neoninc.org
permalink: /R/Convert-to-Date-Time-Class-POSIX-R
comments: false
---

{% include _toc.html %}

##About
This lesson will teach students how to prepare tabular data for further analysis
in R by addressing missing values and date-time formats. Students will also
learn how to convert characters to a date-time class and to convert date-time to
Julian day.

**R Skill Level:** Intermediate - you've got the basics of `R` down and 
understand the general structure of tabular data.

<div id="objectives" markdown="1">

### Goals / Objectives
After completing this activity, you will:
 * Know how to clean data
 * Be able to convert between date & time formats
 * Examine data structures and types

###Things You'll Need To Complete This Lesson
Please be sure you have the most current version of `R` and preferably
R studio to write your code.

####R Libraries to Install
<li><strong>lubridate:</strong> <code> install.packages("lubridate")</code></li>

####Data to Download

<a href="http://files.figshare.com/2437700/AtmosData.zip" class="btn btn-success">
Download Atmospheric Data</a>

The data used in this tutorial were collected at Harvard Forest which is
a the National Ecological Observatory Network field site <a href="http://www.neoninc.org/science-design/field-sites/harvard-forest" target="_blank">
More about the NEON Harvard Forest field site</a>. These data are proxy data for what will be
available for 30 years from the NEON flux tower [from the NEON data portal](http://data.neoninc.org/ "NEON data").

####Setting the Working Directory
The code in this lesson assumes that you have set your working directory to the
location of the unzipped file of data downloaded above.  If you would like a
refresher on setting the working directory, please view the <a href="XXX" target="_blank">Setting A Working Directory In R</a> lesson prior to beginning the lesson.

</div>

In [{{site.baseurl}} / LINKHERE](Lesson 00 - NEED TO ADD LINK) we imported a
`.csv` time series dataset. We learned how to cleanly plot these data by 
converting the date field to an `R` `Date` data type. In this lesson we will 
explore how to work with data field that contains both a date AND a time stamp.

In this lesson, we will use functions from both base `R` and the `lubridate` 
library learn how to work with date-time data types.

We will use the `hf001-10-15min-m.csv` file that contains micrometereology
data including our variables of interest: temperature, precipitation and PAR, 
for Harvard Forest, aggregated at 15 minute intervals.

We will begin by loading the data and viewing its structure in `R`.

```{r load-libraries}

# Load packages required for entire script
library(lubridate)  #work with dates

#set working directory to ensure R can find the file we wish to import
#setwd("working-dir-path-here")

#Load csv file of 15 min meterological data from Harvard Forest
#Factors=FALSE so strings, series of letters/ words/ numerals, remain characters
harMet_15Min <- read.csv(file="AtmosData/HARV/hf001-10-15min-m.csv",
                     stringsAsFactors = FALSE)

#what type of R object is our imported data?
class(harMet_15Min)

#what data classes are within our R object? 
#What is our date-time field called?
str(harMet_15Min)

```

##Dealing with date and time

Have a look at the `datetime` field in the `harmet_15Min object`. What data type
is it in? 

```{r view-date-structure }
#view field data class
class(harMet_15Min$datetime)

#view sample data
head(harMet_15Min$datetime)

```

Our data are in a character data type. We need to convert them to date-time data
type. What happens when we use the `as.Date` method on our `datetime` field?

```{r as-date-only, results="hide" }

#convert field to date format
har_dateOnly <- as.Date(harMet_15Min$datetime)

#view data
head(har_dateOnly)

```

The `as.Date` method worked great for a field with just dates, but it doesn't 
store any time information. Let's take a minute to explore the various date/time
formats in `R`.

## Exploring Date and Time Classes

###R - Date Class - as.Date
We can use the`as.Date` method to convert a date field in string/character 
format to an `R` `Date` class. It will ignore all values after the date string.

```{r explore-as_date }
#Convert character data to date (no time) 
myDate <- as.Date("2015-10-19 10:15")   
str(myDate)
head(myDate)

#whhat happens if the date has text at the end?
myDate2 <- as.Date("2015-10-19Hello")   
str(myDate2)
head(myDate2)

```

###R - Date-Time - The POSIX classes
Given that we do have data and time that are both important for our time series 
we need to use a format that includes time and date.  Base `R` offers two 
closely related classes for date and time: `POSIXct` and `POSIXlt`. Let's 
explore both of these before choosing which one to use with our data.

```{r explore-POSIXct }
#Convert character data to date and time.
timeDate <- as.POSIXct("2015-10-19 10:15")   
str(timeDate)
head(timeDate)

```

The `as.POSIXct` method converts a date-time string into a `POSIXct` or 
date-time class. 

If we look at the data, we see the date and time with a time zone designation. 

```{r time-zone }
#view date - notice the time zone - MDT (mountain daylight time)
timeDate

```

POSIXct stores date and time as the number of seconds since 1 January 1970
(negative numbers are used for dates before 1970). As each date and time is 
just a single number this format is easy to use in dataframes and to convert
from one format to another. 

```{r explore-POSIXct2 }
unclass(timeDate)
```

Here we see the number of seconds from 1 January 1970 to 9 October 2015 and
see that it has a time zone attribute stored with it. 

While easy for data storage and manipulations, humans aren't so good at working
with seconds from 1970 to figure out a date. Plus, we often want to pull out
some portion of the data (e.g., months).  POSIXlt stores date and time
information in a format that we are used to seeing (e.g., 
second, min, hour, day of month, month, year, numeric day of year, etc). 

```{r explore-POSIXlt }
#Convert character data to POSIXlt date and time
timeDatelt<- as.POSIXlt("2015-10-1910:15")  
str(timeDatelt)
head(timeDatelt)

unclass(timeDatelt)
```

When we converted the string to `POSIXlt`, it still appears to be the same as 
`POSIXct`. However, `unclass()` shows us that the data are stored differently. 
The `POSIXlt` format stores the hour, minute, second, and month day year as 
separate components.

Yet, just like `POSIXct` being based on seconds since 1 Jan. 1970, `POSIXlt` has
a few quirks.  First, the months use zero based indexing which starts counting
with zero instead of 1 so October is stored as the 9th month (`$mon = 9`) and 
the years are base on years since 1900 so 2015 is stored as 115 (`$year = 115`)
Information like this can always be found in the `R` documentation by using `?`
or specifically `?POSIXlt`.  

Having dates classified as seperate components makes `POSIXlt` a bit more
difficult to use in data.frames and to manipulate, which is why we won't use
POSIXlt for this lesson.  

Instead we can specified which format (year-month-day hour:minute) we wanted to 
see the date and time when using POSIXct.  This way we know what the date is and
the program can still work with the date/time in a single format.

###R- Data-Time - Other Classes
There are a many other options in `R` for working with date-time formats, 
including packages `readr` and `zoo`. The `chron` package allows the use of time
without a data attached.  

##Convert Date Time to a R date/time class 
Let's convert our data to a date/time field. We will use the `as.POSIXct` function.
We can tell R how our data are formated using a `format=` string as follows

* %Y - year
* %m - month
* %d - day
* %H:%M - hours:minutes

<a href="" target="_blank">ADD LINK TO PAGE WHICH EXPLAINS ALL OF THE OPTIONS
for TIME AND DATE FORMAT</a>



```{r convert-data }

#view one date time entry
harMet_15Min$datetime[1]

#convert single instance to a date/time
as.POSIXct(harMet_15Min$datetime[1],format="%Y-%m-%dT%H:%M")


```


#NOTE - MAKE SURE THE DATA ARE IN EST AND NOT UTC. UTC IS OFTEN A DEFAULT

###Convert data.frame field to a date/time class


We now need to specific the time zone. Remember we learned in the
metadata (Lesson 01) that these data were recorded in Eastern Standard Time. For use in R 
we need to look up the name for the timezone in the 'tz' database. You can find the list 
here:

NOTE: You can look up the time zones here: <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank">
timeszones</a>
{ : .notice }

The code for Eastern Standard Time is  `America/New_York`.

```{r assign-time-zone }

#assign time zone to the field
as.POSIXct(harMet_15Min$datetime[1],
            format = "%Y-%m-%d %H:%M",
            tz = "America/New_York")

```

#Reformatting A date/time data.frame field

Now, using the syntax that we learned above, we can reformat the entire datetime 
format into an `R POSIX` class.

```{r POSIX-convert}
#convert to date-time class
harMet_15Min$datetime <- as.POSIXct(harMet_15Min$datetime,
                                format = "%Y-%m-%dT%H:%M",
                                tz = "America/New_York")

#view format of the newly defined datetime data.frame column 
str(harMet_15Min$datetime)

```

##Converting Between Time Formats - Julian days

Next, we will explore how to convert our time field to a different format. Heterogeneous
data often use different time formats. Thus, it is useful to know how to convert.
We will use Julian Days given we have some other data (NDVI) in Julian days that 
we'd like to compare to our data.

Julian days, as R interprets it, is a continuous count of the number of days 
beginning at Jan 1, each year. Thus each year will have up to 365 (non leap year)
or 366 (leap year) days. 

Note: This format can also be called ordinal day or year day, and, occasionally,
Julian day can refer to a numeric count since 1 January 4713 BC.
{ : .notice }

To quickly convert from month, day year to Julian days, can we use `yday`, a 
function from the `lubridate` library.

```{r julian-day-convert }
# convert to julian days
# to learn more about it type
?yday

harMet_15Min$julian <- yday(harMet_15Min$datetime)  
#make sure it worked all the way through.  Dataframe was 30 variables so julian should be 31st.
head(harMet_15Min$julian) 
tail(harMet_15Min$julian)

```

#NOTE - doing this here doesn't really make sense fully given it removes time.
#i will see what happens in the next lesson.
