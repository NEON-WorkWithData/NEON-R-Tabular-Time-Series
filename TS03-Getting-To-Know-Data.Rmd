---
layout: post
title: "Lesson 03 Getting to Know Your Data"
date:   2015-10-22
authors: "Marisa Guarinello, Megan Jones, Courtney Soderberg"
dateCreated: 2015-10-22
lastModified: 2015-11-02
tags: [module-1]
description: "This lesson will teach individuals how to conduct basic data 
manipulation and create basic plots of time series data."
code1:
image:
  feature: NEONCarpentryHeader_2.png
  credit: A collaboration between the National Ecological Observatory Network (NEON) and Data Carpentry
  creditlink: http://www.neoninc.org
permalink: 

---

<section id="table-of-contents" class="toc">
  <header>
    <h3>Contents</h3>
  </header>
<div id="drawer" markdown="1">
*  Auto generated table of contents
{:toc}
</div>
</section><!-- /#table-of-contents -->


##About
This activity will walk you through the fundamentals of data manipulation and 
basic plotting.

**R Skill Level:** Intermediate - you've got the basics of `R` down.

### Goals / Objectives
After completing this activity, you will know:
* How to create basic time series plots in `R`.
* How to manipulate data in `R`.


###Things You'll Need To Complete This Lesson
Please be sure you have the most current version of `R` and preferably
R studio to write your code.

####R Libraries to Install
<li><code> install.packages("dplyr")</code></li>
<li><code> install.packages("lubridate")</code></li>
<li><code> install.packages("ggplot2")</code></li>

#Plotting Time Series Data
One of the first things that can often be useful to do once we've loaded our 
data and cleaned it up is to visualize the data. We can start to get a sense of 
general trends, and well as see possible outliers or non-sensical values. 

To do this, we're going to use the package `ggplot2` to plot the air temperature across our
3 year span time span for each 15 minute data point.

```{r basic-plotting}
#Remember it is good coding technique to add additional libraries to the top of your script (we started this section in Lesson 02)
library (ggplot2)  #for creating graphs
library (scales)   #to access breaks/formatting functions

#plot Air Temperature Data across 2009-2011 using 15-minute data
AirTemp15m <- ggplot(Har15min.09.11, aes(datetime, airt)) +
           geom_point() +
           ggtitle("Air Temperature At Harvard Forest (15 min. interval)") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Date") + ylab("Air Temperature (C)")
AirTemp15m
```
Here we see that we get a warning message saying that two rows were removed due to missing values.  Those are the two rows that still had NA in the air temperature data.  

The dates on the x-axis are unreadable and not particularly well formatted. We can reformat them 
so they are in the Month/Day/Year format we are used to.
```{r nice-x-axis}
#format x axis with dates
AirTemp15m + scale_x_datetime(labels=date_format ("%m/%d/%y") )
```

#Challenge: Plotting daily precipitaiton data

Using the daily precipitation data you imported earlier, create a plot with the
x-axis in a European Format (Day/Month/Year)
``` {r challenge-2}
Date<-as.Date(harDaily.09.11$date)

PrecipDaily <- ggplot(harDaily.09.11, aes(Date, prec)) +
           geom_point() +
           ggtitle("Daily Precipitation at Harvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Date") + ylab("Precipitation (mm)") +
          scale_x_date(labels=date_format ("%d/%m/%y"))

PrecipDaily
```


#Manipulating Data
Looking back at the 15 minute air temperature plot, the date is interesting and
we can, unsurprisingly,see a clear seasonal trend. Yet the air temperature data
at 15 minute intervals might be more granular than we want. Instead, we may want
to look at how daily average temperature changes over time. To do this we first 
need to learn a bit about how to manipulate data in R. We'll use the `dplyr` 
package and a "split-apply-combine" technique.

``` {r load-dplyr}
library (dplyr)   #aid in manipulating data
```

We use the `group-by()` function to determine how we split up our data. For 
example, if we wanted to count up the number of observations per Julian date, 
we would do

```{r dplyr-group}
yr.09.11 %>%
  group_by(julian) %>%
  tally()
```
The `%>%` at the end of the lines are 'pipes'. They allow you to take the output
of one function and send it to the next function. This means you don't have to 
save the intermediate steps between functions.

We're more interested though in calculting single values by julian day. We can 
use the `summarize()` function for this. To get the mean air temperature for 
each julian day, we would write:
```{r dplyr summarize}
yr.09.11 %>%
  group_by(julian) %>%
  summarize(mean_airt = mean(airt, na.rm = TRUE))
```

Julian days repeat though, so if we want to summarize our air temperature data 
for each day, we actually need to group our data by two different values at once,
year and julian day. To do this, we're first going to need to create a new year
variable. For this we'll use the `lubridate` package.

```{r dplyr-lubridate}
yr.09.11$year <- year(as.Date(yr.09.11$datetime, "%y-%b-%d",
      tz = "America/New_York"))
```

This code will work, but we previously already set up datetime as a time variable,
so we can be a bit more efficient an just put:

```{r dplyr-lubridate-2}
yr.09.11$year <- year(yr.09.11$datetime)
```

Now we have our two variables. So, to get the mean air temperature for each day
for each year, we would write:

```{r dplyr-full}
yr.09.11 %>%
  group_by(year, julian) %>%
  summarize(mean_airt = mean(airt, na.rm = TRUE))
```


Could we create the year variable within our `dplyr` function call? Yep. We can
use the `mutate()` function, and include our `lubridate` function within the
`mutate()` call.

```{r dplyr-mutate}
yr.09.11 %>%
  mutate(year = year(datetime)) %>%
  group_by(year, julian) %>%
  summarize(mean_airt = mean(airt, na.rm = TRUE))
```

#Challenge: Can you get the average air temperate for each month?

We also want to save this information so that we can plot the daily air
temperature as well. So, we save the output of our dplyr function as a new
dataframe. Since we're going to plot this, we also want to retain the datetime
information so that we can have our nicely formatted x-axis. But, we only want
one datetime entry per air temperature measurement. So, we ask R to give us the
first datetime entry for each day for each year in the `summarize()` function.

```{r dplyr-saving}
temp.daily <- yr.09.11 %>%
  mutate(year = year(datetime)) %>%
  group_by(year, julian) %>%
  summarize(mean_airt = mean(airt, na.rm = TRUE), datetime = first(datetime))
```

#Challenge: Using the daily preceptitation datafile, what is the precipitation
for each year? Does it make more sense to get the total precepitation for each
year, or the average percipitation for each year?

Now that we have our new data file, we want to plot the daily averages.

```{r daily-plot}
dailyPlot <- ggplot(temp.daily,aes(datetime, mean_airt)) +
           geom_point() +
           ggtitle("Daily Avg Air Temperature\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
          theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Air Temperature")

#format x axis with dates
dailyPlot + scale_x_datetime(labels = date_format("%m/%d/%y"))
```
