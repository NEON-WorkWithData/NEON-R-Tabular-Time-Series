---
layout: post
title: "Lesson 00: Working With Date Formats in R - Intro to Tabular Time Series"
date:   2015-10-25
authors: [Megan A. Jones, Marisa Guarinello, Courtney Soderberg]
contributors: [Leah A. Wasser]
dateCreated:  2015-10-22
lastModified: `r format(Sys.time(), "%Y-%m-%d")`
tags: [module-1]
description: "This lesson will demonstrate how to import a time series dataset 
stored in .csv format into R. It will explore column formats and will walk through 
how to convert a date field, stored as a character string, into a date field that
R can recogniaze and plot efficiently."
image:
  feature: NEONCarpentryHeader_2.png
  credit: A collaboration between the National Ecological Observatory Network (NEON) and Data Carpentry
  creditlink: http://www.neoninc.org
comments: false
---

{% include _toc.html %}

##About
This learning module will walk you through the fundamental principles of working 
with `.csv` temporal data in `R` including how to open, clean, explore, and plot 
time series data. 

<div id="objectives" markdown="1">

**R Skill Level:** Intermediate - you've got the basics of `R` down.

###Goals / Objectives
After completing this learning module, you will know how to:

  * Open a `.csv` file in 'R'using `read.csv`.
  * Work with `date.frame` fields in `R`.
  * Examine data structures and types
  * Convert a date field, stored as a character into an `R` date format.
  * Plot a time-series dataset using `qplot` 

###Things You'll Need To Complete This Lesson

####R Libraries to Install

* **ggplot:** `install.packages("ggplot2")`


####Tools To Install

Please be sure you have the most current version of 'R'and, preferably,
RStudio to write your code.

####Data to Download

<a href="http://files.figshare.com/2437700/AtmosData.zip" class="btn btn-success">
Download Atmospheric Data</a>

NOTE: The data used in this tutorial were collected at Harvard Forest which is
a the National Ecological Observatory Network field site 
<a href="http://www.neoninc.org/science-design/field-sites/harvard-forest" target="_blank">
More about the NEON Harvard Forest field site</a>. These data are proxy data for 
what will be available for 30 years [on the NEON data portal](http://data.neoninc.org/ "NEON data")
for both Harvard forest and other field sites located across the United States.

</div>



#The Data Approach

In this lesson, we will explore micro-meterology data collected from a 
<a href="http://www.neoninc.org/science-design/collection-methods/flux-tower-measurements" target="_blank">flux
tower</a> at the NEON Harvard Forest field site. We are interested in exploring 
patterns associated with changes in temperature, precipitation, PAR and day 
length - metrics that impact changes in plant phenology 

<link to phenology as a 
science topic - pbb??>

#About .csv file format

We have received data from a flux tower at Harvard Forest in `.csv` format.
`.csv` stands for comma separated values. It is a text file based format, where 
each value in the dataset
is separate by a comma. Plain text formats are ideal for working both across 
platforms (MAC, PC, LINUX, etc) and also can be read by many different tools. This
file format is further less likely to become obsolete over time!

* <a href="" target=_blank"> MORE ON CSV HERE...FIND LINK?**</a>

Our `.csv` file contains a suite of metrics that we are interested in. To begin 
exploring  the data, we need to first import it into R. We can use the function `read.csv` 
to import the data. We can then explore the data structure.


```{r load-libraries}
# Load packages required for entire script
# what libraries are required for this lesson?
# library(nameOfLibrary)  #purpose of library

#load ggplot2 - efficient, pretty plotting - required to qplot function
library(ggplot2)

#set working directory to ensure R can find the file we wish to import

setwd("workingDirHere")

```

Once our working directory is set, we can import import the data using `read.csv`. 
Note that we will use `stringsAsFactors = FALSE`.

**DO WE NEED TO EXPLAIN FACTORS?? at the least we should link to something on factors**

```{r import-csv}

#Load csv file of daily meterological data from Harvard Forest
#don't load strings (a series of letters or numerals) as factors so they remain characters
harMetdaily <- read.csv(file="AtmosData/HARV/hf001-06-daily-m.csv",
                     stringsAsFactors = FALSE)

#what type of R object is our imported data?
class(harMetdaily)

```

#Data.Frames in R
When we use the read.csv function, `R` imports the data in `data.frame` format.
This format is idea for working with tabular data. It is similar to a spreadsheet.


## Data Structure & Metadata
Once our data are imported, we can explore its structure. Let's have a look 
at the data structure using the `head()` method. This will show us the first
6 rows of the data. We can use the `str` method to view the structure of the data.

```{r view-data-structure}

#view first 6 rows of the dataframe 
head(harMetdaily)

#View the structure (str) of the data 
str(harMetdaily)

```

##Data Structure - Formats in R

The structure of our data tells us that there the data are stored in several formats
in our `.csv`:

* **chr** - a few sentences on character strings here
* **int** - a few sentences...
* **num** - a few sentences.

Storing variables in different formats is a strategic decision by `R`. ... more
on why this is efficient here.

#Plot data using qplot

Let's have a look at one of the metrics, stored within our data - `airt` which is
air temperature. Given this is a time series dataset, we might want to plot
air temperature as it changes over time. We have a date time field so let's use
that as our x axis variable, `airt` will be our Y axis variable.

We will use the `qplot` function in the `ggplot2` library which stands for quick plot.
`qplot` requires the x and y axis variables and then the data that the variables 
are stored in. 

```{r plot-data}
#quickly plot the data
qplot(x=date,y=airt, data=harMetdaily)

```

We have successfully plotted some data. However, what is going on - on the x axis.
R is trying to plot EVERY date value on the x Axis - so it's not readable? Why?
Let's have a look at the format of the fields that we are trying to plot.

#NOTE - We might want to subset this to maybe a single year.

```{r view-field-structure }
# View data structure for each column that we wish to plot
class(harMetdaily$date)

class(harMetdaily$airt)

```

Looking at our data, we can see that the datetime field actually imported into
`R` as a character format. This means that `R` does not know how to plot these 
data as a continuous variable on the X axis. The `airt` field is numeric so that 
field should plot, just fine.

#Working With Time Formats
We need to convert our date field, which is currently stored as a character value
to an actual date format that can be displayed quantitively. Lucky for us, `R` has 
`date` format. We can reassign the `harMetdaily$date` field using `as.date`.

```{r convert-date-time }

#convert field to date format
harMetdaily$date <- as.Date(harMetdaily$date)

#view results
head(harMetdaily$date)

#view structure of field
class(harMetdaily$date)

```

Now that we have adjusted the date, let's plot again. Notice that it plots
much more quickly now that R recognizes the date as a date field. R can agregate
ticks on the x axis by year instead of trying to plot every day!

```{r plot-data}
#quickly plo the data
qplot(x=date,y=airt, 
      data=harMetdaily,
      main="Daily Air Temperature w Date Assigned\nNEON Harvard Forest")
```


#Challenge
> 1. Plot something else?? what else should we plot.
> 2. it could be cool to show them how to aggregate - adjust tick marks by 5 years, 10 years, etc
> 3. it could be cool to show them how to add x lab and y lab
> 4. plot on variable vs another??




############## REMOVE STUFF BELOW ??
#Recommended Pre-Module Reading

## Time series data
Time series data can come in many different forms.  At the fundemental level a 
time series is a series of data points collected at successive time intervals. 
Lots of data collected can be time series data: heights of ocean tides, the 
number of toes that different equine species had over the last 60 mya, or daily 
temperature measures.  This module will specifically look at atmospheric data 
(temperature, precipitation, and photosynthetically active radiation (PAR)) 
recorded over various time intervals (every 1 sec, 15 min, daily) and will also use
the normalized difference vegetative index (NDVI) calculated from remote sensing
data.
 
## PAR
PAR is a measure of how much light within the solar radiation spectral range 
(wave band) from 400 to 700 nanometers is present at the time when the data is 
collected.  This wavelength is important for phenology studies as that spectral
range is what photosynthetic organisms are able to use in the process of 
photosynthesis.

## NDVI
NDVI is an index calculated from spectral reflectance measurements acquired in 
the visible (red) and near-infrared regions by sensors on earth-observing satellites.
This index indicates how green plants in the target area are and is often
used in phenology studies as it can be used to determine growing and dormant seasons.

# Additional information if working through module as an individual, not as part of a workshop. 
This .csv time-series learning module was build as part of the two day Spatio-
Temporal Data Workshop [LINK]XXX. Therefore some background information and 
basic coding skills have been covered extensively in previous modules and are
presented here in a more limited fashion. You should be able to complete this 
module as long as you are comfortable with basic 'R' skills and have a general
understanding of spatial data.   

This workshop is built around Jessica, an ecology graduate student interested in
exploring some of her field sites to understand how phenology of vegetation 
(greening in the spring/summer and senescence in the winter, varies across 
multiple sites and through time). Her potential study sites have very different 
vegetation communities including Harvard Forest (Massachusetts) and San Joaquin 
Experimental Range (California). The data includes spatial and temporal raster 
data ([Link] Module XXX), vector data ([Link] Module XXX), and various 
atmospheric parameters that are collected over several years (this module) that 
she would like to be able explore prior to her initial site visits and writing 
her dissertation proposal. 

 

You are now ready for Lesson 01 in the Tabular Time Series Module

