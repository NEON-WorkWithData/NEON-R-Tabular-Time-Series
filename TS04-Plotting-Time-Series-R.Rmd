---
layout: post
title: "Lesson 04: Plotting Time Series with ggplot in R"
date:   2015-10-21
authors: [Megan A. Jones, Marisa Guarinello, Courtney Soderberg]
contributors: [Leah A. Wasser, Michael Patterson]
dateCreated: 2015-10-22
lastModified: `r format(Sys.time(), "%Y-%m-%d")`
tags: [module-1]
packagesLibraries: [lubridate, ggplot2, scales, gridExtra, dplyr]
category: 
description: "This lesson teaches how to create plots of time series data using `ggplot()`."
code1:
image:
  feature: NEONCarpentryHeader_2.png
  credit: A collaboration between the National Ecological Observatory Network (NEON) and Data Carpentry
  creditlink: http://www.neoninc.org
permalink: /R/Plotting-Time-Series-with-ggplot
comments: false
---

{% include _toc.html %}


##About
This lesson teaches how to create plots of time series data using `ggplot()`

**R Skill Level:** Intermediate - you've got the basics of `R` down.

<div id="objectives" markdown="1">

### Goals / Objectives
After completing this lesson, you will:
 * Be able to create basic time series plots using `ggplot()` in `R`
 * Be able to choose between visually representing data as points or bars in a
 plot.
 
 

###Things You'll Need To Complete This Lesson
Please be sure you have the most current version of `R` and, preferably,
RStudio to write your code.

####R Libraries to Install
<li><strong>lubridate:</strong> <code> install.packages("lubridate")</code></li>
<li><strong>ggplot2:</strong> <code> install.packages("ggplot2")</code></li>
<li><strong>scales:</strong> <code> install.packages("scales")</code></li>
<li><strong>gridExtra:</strong> <code> install.packages("gridExtra")</code></li>
<li><strong>dplyr:</strong> <code> install.packages("dplyr")</code></li>

  <a href="http://neondataskills.org/R/Packages-In-R/" target="_blank">
More on Packages in R - Adapted from Software Carpentry.</a>

####Data to Download
{% include /maps/_tabular-time-series-data.html %}


####Setting the Working Directory
The code in this lesson assumes that you have set your working directory to the
location of the unzipped file of data downloaded above.  If you would like a
refresher on setting the working directory, please view the [Setting A Working Directory In R](URL "R Working Directory Lesson") lesson prior to beginning
this lesson.

</div>

Working with micro-meteorology data from Harvard Forest, we are going to
learn skills that will enable us to visualize our data by:

1) plotting daily and  15-minute air temperature data across years,

You will need the daily and 15-minute micro-meteorology data for 2009-2011 from
the Harvard Forest. If you do not have these data sets, as `R` objects created in
[{{site.baseurl}} / LINKHERE](Lesson 00 - ) and [{{site.baseurl}} / LINKHERE](Lesson 01 - )
please load them from the .csv files in the downloaded data.  

```{r load-data}
#Remember it is good coding technique to add additional libraries to the top of
  #your script 
library(lubridate) #for working with dates
library(ggplot2)  #for creating graphs
library(scales)   #to access breaks/formatting functions
library(gridExtra) #for arranging plots

#set working directory to ensure R can find the file we wish to import
#setwd("working-dir-path-here")

#If not already available from Lesson 01-03:
#15-min Harvard Forest met data, 2009-2011
harMet15.09.11<- read.csv(file="Met_HARV_15min_2009_2011.csv",
                          stringsAsFactors = FALSE)
#convert datetime to POSIXct
harMet15.09.11$datetime<-as.POSIXct(harMet15.09.11$datetime,
                    format = "%Y-%m-%dT%H:%M",
                    tz = "America/New_York")
#daily HARV met data, 2009-2011
harMetDaily.09.11 <- read.csv(file="Met_HARV_Daily_2009_2011.csv",
                     stringsAsFactors = FALSE)

#covert date to POSIXct date-time class
harMetDaily.09.11$date <- as.POSIXct(harMetDaily.09.11$date)
```

##Plotting Time Series Data
Visualization of data is important as it allow us to start to get a sense of 
general trends, as well as see possible outliers or non-sensical values. 

###Plotting with `qplot()` 
Using the library `ggplot2` we can use the simple `qplot()` function
that was introduced in [{{site.baseurl}} / LINKHERE](Lesson 00 - ) to make a
quick plot of the air temperature (`airt`) across all three years using the
15-min data. Here we introduce a new feature of ggplot, adding labels to
the x and y axes using `xlab=` and `ylab=`.

``` {r qplot}
qplot (x=datetime, y=airt,
      data= harMet15.09.11,
      main= "Air temperature Harvard Forest\n 2009-2011",
      xlab= "Date", ylab= "Temperature (Â°C)")
```

We get a warning message reminding us there there are two missing values in the 
air temperature data and a plot showing the pattern of air temperature across
the three years.

### Plotting with `ggplot()`
While `qplot` is a simple way to quickly plot data, it is limited in it's ability
to be modified and customized into professional looking plots.  The `ggplot()` 
function within `ggplot2` package allows the user to have much more control
over the appearance of the plot.  

Let's plot the same data again using `ggplot()`.  While `ggplot()` is based on 
using much of the information we just used with `qplot` the syntax is 
different: 

* the data source is now the first element,
* `aes` (aesthetics) are where the variables for the x, y (and 
other) axes are entered,  
* `geom_XXX` (geometry), in this lesson `geom_point`, is used to define the type of
demarcation you want to represent the data.  We want a scatterplot so we are
using geom_point. The default is small round filled circles, 
* within the parameters for `geom_point` we will specify that all na values 
shoud be removed `na.rm=TRUE`.  This will prevent the warning messages from 
showing,
* `ggtitle` is now how we give the plot a title,
* `xlab` and `ylab` are still how we label the axes.  

Remember `help(ggplot2)` will list the many other parameters that can be 
defined. There are far more ways ggplot can be used to customize and stylize
your plots, but we will not cover those additional details in this lesson to
keep the focus on working with time series data.

``` {r basic-ggplot2}
#plot Air Temperature Data across 2009-2011 using 15-minute data
AirTemp15a <- ggplot(harMet15.09.11, aes(datetime, airt)) +
           geom_point(na.rm=TRUE) +    #na.rm=TRUE prevents a warning stating
                                      # that 2 NA values were removed.
           ggtitle("15 min Air Temperature At Harvard Forest") +
           xlab("Date") + ylab("Air Temperature (C)")
AirTemp15a
```

Notice we created an object (AirTemp15a) that is our plot.  We then have to
write in the object name to get the plot to appear.  Creating plots as an 
`R object` has many advantages including being able to simply add to a plot as we
will do in just a few lines and to be able to recall a plot later on in code as
we do at the end of this lesson. 

The dates on the x-axis in this last plot are not particularly
well formatted. We can reformat them so they are in the Month/Day/Year format by 
simply adding onto the `AirTemp15a` plot that we just created. 
```{r nice-x-axis}
#format x axis with dates
AirTemp15b <- AirTemp15a + (scale_x_datetime(labels=date_format("%m/%d/%y")))
AirTemp15b
```

The dates are now legible and in a format that is more common. 

Bonus: If an x variable is not a datetime class (e.g., not POSIX),
`scale_x_...()` exist to help format x-axes. {.notice2}

The ability to customize nearly every aspect of the plot is one of the reasons
to use `ggplot2`. We can make the labels and title look better as well by
specifying aspects of `theme()`.  

```{r nice-font}
#format x axis with dates
AirTemp15<-AirTemp15b +
  theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
  theme(text = element_text(size=20)) 
AirTemp15
```


##Challenge: Plotting daily precipitaiton data
Using the daily precipitation data you imported earlier, create a plot with the
x-axis in a European Format (Day-Month-Year).  For ease in future activities 
name the plot 'PrecipDaily".

``` {r challenge-code-ggplot-precip}
PrecipDaily <- ggplot(harMetDaily.09.11, aes(date, prec)) +
           geom_point() +
           ggtitle("Daily Precipitation at Harvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",
                 size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Date") + ylab("Precipitation (mm)") +
          scale_x_datetime(labels=date_format ("%d-%m-%y"))

PrecipDaily
```

We will return to precipitation data in Challenge 4 and discuss this plot. 

